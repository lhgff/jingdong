var clipstring=function(a,b){if(!a||!b)return"";for(var d=0,c=0,e="",c=0;c<a.length;c++){255<a.charCodeAt(c)?d+=2:d++;if(d>b)return e+"..";e+=a.charAt(c)}return a},tvPagePopup={id:null,req:24,tvData:"",state:0,init:function(){this.GetTVPageInfoCallback();this.addPageContIndex()},AddTVByJsonCallback:function(){window.close();console.log("\u52a0\u5165\u8ffd\u5267\u6210\u529f\uff01")},GetTVPageInfoCallback:function(){var a=this,b=window.localStorage.getItem("page_tvpopup");if(a.tvData=b)b=JSON.parse(b),
console.log("json:",b),tvPagePopup.id=b.id,a.state=parseInt(b.state),$("#load4 img").attr("src",b.coverImage),a.state?(a.req=36,$("#load4 p").html("\u628a\u300a<span>"+clipstring(b.title,18)+"</span>\u300b<br />\u52a0\u5165\u8ffd\u5267\uff1f\u770b\u5267\u66f4\u65b9\u4fbf\uff01"),$("#load4 .p1").html("\u4e0d\u518d\u63d0\u9192"),$("#load4 .btn").html("\u52a0\u5165\u8ffd\u5267")):$("#load4 p").html("\u300a<span>"+clipstring(b.title,20)+"</span>\u300b<br />&nbsp;&nbsp;\u66f4\u65b0\u540e\u4f1a\u63d0\u9192\u4f60\u54e6\uff01"),
$("#load4").attr("videoid",b.id),$("#load4").attr("_url",b.coverUrl),$("#load4").attr("_title",b.title),legoAfterPlay.Report([125,a.req,"3",b.title]),$("#load4 .btn").click(function(){legoAfterPlay.GetButtonVisible(function(b){var c=$("#load4").attr("_title");legoAfterPlay.Report([125,a.req,"1",String(c)]);window.localStorage.getItem("showpop")||1==b?tvPagePopup.AddTVInfo(1):(tvPagePopup.AddTVInfo(1),legoAfterPlay.SetButtonVisible("1"),setTimeout(function(){chrome.browserAction.setPopup({popup:"pop.html"});
legoAfterPlay.Popup('{"popup":"0"}');chrome.browserAction.setPopup({popup:""})},200))})}),$("#load4 .p1").click(function(){legoAfterPlay.Report([125,a.req,"5",""]);a.CloseTVPopup()})},AddTVInfo:function(a){var b=$("#load4").attr("_title");$("#load4").attr("videoid");a&&legoAfterPlay.AddTVByJson(tvPagePopup.tvData,tvPagePopup.AddTVByJsonCallback);legoAfterPlay.Report([125,tvPagePopup.req,"4",String(b)]);tvPagePopup.removePageCont();tvPagePopup.CloseTVPopup()},CloseTVPopup:function(){legoAfterPlay.DisablePageTip($("#load4").attr("_url"));
tvPagePopup.removePageCont();window.close()},removePageCont:function(){var a=window.localStorage.getItem("tabs_pop_cont");if(a){var a=JSON.parse(a),b;for(b in a)if(RegExp(tvPagePopup.id).test(b)){a[b]="";window.localStorage.setItem("tabs_pop_cont",JSON.stringify(a));break}}},addPageContIndex:function(){var a=window.localStorage.getItem("tabs_pop_cont");if(a){var a=JSON.parse(a),b;for(b in a)if(RegExp(tvPagePopup.id).test(a[b].tv_info)){a[b].num=1+parseInt(a[b].num?a[b].num:0);2<=a[b].num&&(a[b]="");
window.localStorage.setItem("tabs_pop_cont",JSON.stringify(a));break}}}};tvPagePopup.init();setTimeout(function(){tvPagePopup.removePageCont();tvPagePopup.AddTVInfo(!tvPagePopup.state)},3E4);chrome.tabs.onSelectionChanged.addListener(function(a,b){window.close()});chrome.tabs.onUpdated.addListener(function(a,b){"loading"==b.status&&window.close()});
