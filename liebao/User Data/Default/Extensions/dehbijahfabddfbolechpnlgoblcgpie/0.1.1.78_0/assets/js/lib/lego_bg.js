(function(){function p(a){return"object"!==typeof a?"":Object.keys(a).map(function(c){return encodeURIComponent(c)+"="+encodeURIComponent(a[c])}).join("&")}function q(a,c){function d(){if(4===b.readyState)if(b.removeEventListener("readystatechange",d,!1),200===b.status){var a=new FileReader;a.readAsDataURL(b.response);var h=function(){a.removeEventListener("loadend",h,!1);c(a.result)};a.addEventListener("loadend",h,!1)}else c(!1)}var b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="blob";b.addEventListener("readystatechange",
d,!1);b.send()}function r(a,c){function d(){4===b.readyState&&(b.removeEventListener("readystatechange",d,!1),200===b.status?c(b.responseText):c(!1))}var b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="text";b.addEventListener("readystatechange",d,!1);b.send()}function s(a,c){function d(){4===e.readyState&&(e.removeEventListener("readystatechange",d,!1),200===e.status?c(e.responseText):c(!1))}var b=a.url,f=a.method||"GET",h=a.data,g=p(h);"GET"===f&&h&&(b=-1===b.indexOf("?")?b+("?"+g):b+("&"+
g));var e=new XMLHttpRequest;e.open(f,b,!0);e.responseType="text";e.addEventListener("readystatechange",d,!1);"POST"===f&&h?(e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(g)):e.send()}function t(a,c,d){return window.external&&external.lego?external.lego.Report?(external.lego.Report(a,c,d),!0):external.lego.Common.Report(a,c,d):!1}function u(a){return external.lego?external.lego.GetVersion?(a(external.lego.GetVersion('{"version":""}')),!0):external.lego.Common.GetInfo('{"version":""}',
a):!1}function v(a){function c(b){b in k?a(k[b]):a(w)}var d=x;if(window.external&&external.lego&&external.lego.browser){if(external.lego.browser.GetButtonVisibleEx)return external.lego.Browser.GetButtonVisibleEx(c);try{d=external.lego.browser.GetButtonVisible()}catch(b){return c(d),!1}c(d);return!0}return!1}var m=Object.create(null),n=Object.create(null),l={show:"1",fold:"2",hidden:"-1"},w="unkown",x="-999",k={};Object.keys(l).forEach(function(a){k[l[a]]=a});var g=Object.create(null);chrome.runtime.onMessage.addListener(function(a,
c,d){if(c.tab&&c.id===chrome.runtime.id){var b=a.path,f=a.token,h=a.interval,k=a.timeout,e=c.tab.id;switch(a.type){case "chrome.lego.getManifest":d(chrome.runtime.getManifest());break;case "chrome.lego.getFile":if(b in m)d(m[b]);else return q(b,function(a){m[b]=a;d(a)}),!0;break;case "chrome.lego.getTextFile":if(b in n)d(n[b]);else return r(b,function(a){n[b]=a;d(a)}),!0;break;case "chrome.lego.contentScriptReport":t(a.reportName,a.reportType,a.reportData);break;case "chrome.lego.contentScriptGetBrowserVersion":return u(function(a){var b=
{};try{b=JSON.parse(a)}catch(c){}d(b.version||"0.0.0.0")}),!0;case "chrome.lego.contentScriptGetBrowserActionVisibleState":v(d);break;case "chrome.lego.contentScriptSetBrowserActionVisibleState":a=a.state;c=!0;if(a in l)try{c=external.lego.browser.SetButtonVisible(l[a])}catch(p){c=!1}else c=!1;d(c);break;case "chrome.lego.setTimeout":return g[f]=setTimeout(function(){d();delete g[f]},k),!0;case "chrome.lego.clearTimeout":delete g[f];break;case "chrome.lego.setInterval":g[f]=setInterval(function(){chrome.tabs.sendMessage(e,
{type:"chrome.lego.setInterval.callback",token:f})},h);break;case "chrome.lego.clearInterval":clearInterval(g[f]);delete g[f];break;case "chrome.lego.ajax":return s(a.option,d),!0}}})})();
