function report_mes(){return external.lego?external.lego.Common&&external.lego.Common.Report?external.lego.Common.Report:external.lego.Report?external.lego.Report:void 0:function(){console.log("NOT IN LIEBAO BROWSER!")}}function stopBubble(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0}var $=function(e){return document.getElementById(e)},dataArray,news_content,news_content_a,TODAY=(new Date).toLocaleDateString().match(/\d+/g).join("/"),send_report=report_mes(),ws=window.localStorage,WEATHERDATA="",weatherURL="http://www.duba.com/tianqiyubao.html?f=lbtq&cityid=";$("cancelBtn").onclick=function(e){send_report(137,102,"&value1=1&value2=2&value3="+localStorage.cityCode),window.close(),stopBubble(e)},$("info_settings").onclick=function(e){window.close(),stopBubble(e),chrome.extension.sendMessage("",{act:"show_settings"},function(e){}),external.lego.browser.Popup('{"popup":"0"}'),chrome.browserAction.setPopup({popup:""})},window.onblur=function(){window.setTimeout(function(){window.close()},1e4)};var ADLINK="",upReport=function(e){var t=new XMLHttpRequest;t.open("GET",e,!1),t.send(null)},getAdData=function(e){window.external.lego.ADService.GetADByPosition("lb_tq_popup_news","","",function(e,t){try{var n=JSON.parse(e);if(""==n.url||null==n.url)ADLINK="false";else if(n.url){for(var a,o=n.url.split("&"),r=0;r<o.length;r++){var i=o[r].split("=");"ad_id"==i[0]&&(a=i[1])}ADLINK=n.url+"report="+n.report_param+"&ad_id="+a,upReport(n.report_param+"&ad_id="+a+"&snode=201")}}catch(l){throw l}popup_update.init()})}(),popup_update={init:function(){function e(){if(null!=ADLINK.match("http")){var e=$("ad_ifram");e.style.display="block",e.innerHTML='<iframe marginwidth="1" marginheight="1" src="'+ADLINK+'" frameborder="no" width="260" scrolling="no" height="19"></iframe>'}}function t(e,t){var n="晴*01,多云*02,阴*03,小雨*04,中雨*05,大雨*06,雨*07,暴雨*07,冻雨*07,特大暴雨*07,大暴雨*07,阵雨*08,雷雨*09,雷阵雨*09,雪*10,雨夹雪*11,小雪*12,中雪*12,大雪*12,暴雪*12,阵雪*12,冰雹*13,大雾*14,雾*14,霾*14,雾霾*14,沙尘*15,扬沙*15,强沙尘暴*15,沙尘暴*15,浮尘*15",a="",o="";try{null!=e.match(/伴有(.*)/)?a=e.match(/伴有(.*)/)[0]:null!=e.match(/到(.*)/)?(a=e.match(/到(.*)/)[1],null!=a.match(/转(.*)/)&&(a=a.match(/转(.*)/)?a.match(/转(.*)/)[1]:a)):null!=e.match(/转(.*)/)?(a=e.match(/转(.*)/)?e.match(/转(.*)/)[1]:e,null!=a.match(/到(.*)/)&&(a=a.match(/到(.*)/)[1])):a=e.match(/转(.*)/)?e.match(/转(.*)/)[1]:e}catch(r){console.log(r)}var i=new RegExp(a+"\\*(\\d*)?\\,");try{o=t?weathGif.match(i)[1]:n.match(i)[1]}catch(r){console.log(r)}return o}function n(e){var t="晴*1,多云*2,阴*3,小雨*4,中雨*5,大雨*5,雨*5,暴雨*5,冻雨*5,大暴雨*5,特大暴雨*5,阵雨*5,雷雨*5,雷阵雨*5,雪*6,雨夹雪*6,小雪*6,中雪*6,大雪*6,阵雪*6,暴雪*6,冰雹*6,雾*7,大雾*7,霾*7,雾霾*7,沙尘*7,扬沙*7,强沙尘暴*7,沙尘暴*7,浮尘*7",n="",a="";try{null!=e.match(/伴有(.*)/)?n=e.match(/伴有(.*)/)[0]:null!=e.match(/到(.*)/)?(n=e.match(/到(.*)/)[1],null!=n.match(/转(.*)/)&&(n=n.match(/转(.*)/)?n.match(/转(.*)/)[1]:n)):null!=e.match(/转(.*)/)?(n=e.match(/转(.*)/)?e.match(/转(.*)/)[1]:e,null!=n.match(/到(.*)/)&&(n=n.match(/到(.*)/)[1])):n=e.match(/转(.*)/)?e.match(/转(.*)/)[1]:e}catch(o){console.log(o)}var r=new RegExp(n+"\\*(\\d*)?\\,");return a=t.match(r)[1]}try{var a=JSON.parse(ws.shuju);try{var o=JSON.parse(ws.newsC)}catch(r){return console.log("Data errro"),window.close(),!1}if(a&&o.length>0&&null!=ADLINK.match("http"))try{if(ws.newsC){var i=JSON.parse(ws.newsC);e(),$("info_footer").style.height="80px"}}catch(r){return console.log("Data errro"),window.close(),!1}else if(a&&0==o.length&&null!=ADLINK.match("http"))e(),$("ad_ifram").style.top=0;else if(a&&o.length>0&&null==ADLINK.match("http"))try{if(ws.newsC)var i=JSON.parse(ws.newsC)}catch(r){return console.log("Data errro"),window.close(),!1}else a&&0==o.length&&null==ADLINK.match("http")&&($("info_footer").style.display="none")}catch(r){return console.log("Data errro"),window.close(),!1}var l=a.msgdata;$("loading").style.display="none",i&&(news_content=i[0].Title,news_content_a=i[0].link),i&&($("media_content").innerHTML=news_content,$("media_content").href=news_content_a,$("media_content").style.display="block"),console.log(l);var c=(new Date).getTime(),p=new Date(TODAY+" 18:00:00").getTime();c>p?(dayTypeTonight=l.yb.weatherinfo.img_title1,l.yb.weatherinfo.img_title2==l.yb.weatherinfo.img_title3?l.yb.weatherinfo.weather2=l.yb.weatherinfo.img_title2:l.yb.weatherinfo.weather2=l.yb.weatherinfo.img_title2+"转"+l.yb.weatherinfo.img_title3):dayTypeTonight=l.yb.weatherinfo.img_title2,cityName=l.weatherInfo.city,nowTemp=l.sk.weatherinfo.temp,today_tem_wind=l.sk.weatherinfo.WD,today_tem_wind_level=l.sk.weatherinfo.WS,dayType=l.yb.weatherinfo.weather2,dayTemp=popup_update.sortTemp(l.yb.weatherinfo.temp2),dayTempTonight=popup_update.sortTemp(l.yb.weatherinfo.temp1);var s=["优","空气良好","轻度污染","中度污染","重度污染","严重污染"];if(dayType.length>4?($("weather_qk_wrap").style.display="block",$("tem_p").style.fontSize="14px"):($("tem_p").style.fontSize="16px",$("today_wind_wrap").style.display="block"),dayTypeTonight.length>5&&($("tonight_info").style.display="block",$("tonight_info").style.position="relative",$("tonight_info").style.top="-13px",$("tonight_pm").style.position="relative",$("tonight_pm").style.top="-10px",$("tonight_pm").style.marginLeft="0"),l.weatherInfo.aqi&&l.weatherInfo.aqi.pm25){var h=l.weatherInfo.aqi.pm25,w=0,m=l.weatherInfo.aqi;m.aqi>0&&m.aqi<=50?w=0:m.aqi>50&&m.aqi<=100?w=1:m.aqi>100&&m.aqi<=150?w=2:m.aqi>150&&m.aqi<=200?w=3:m.aqi>200&&m.aqi<=300?w=4:m.aqi>300&&(w=5);var u="优*01,空气良好*01,轻度污染*02,中度污染*02,重度污染*02,严重污染*02,",d=s[w],y=new RegExp(d+"\\*(\\d*)?\\,"),_=u.match(y)[1],g="";switch(_){case"01":g="#5795F2";break;case"02":g="#DC5050"}$("tonight_pm").style.backgroundColor=g,$("tonight_pm_air").innerHTML=s[w],$("tonight_pm_number").innerHTML=h}$("update_city").innerHTML=cityName,$("weather_qk").innerHTML=dayType+" ",$("today_wind").innerHTML=today_tem_wind+today_tem_wind_level,$("weather_tem").innerHTML=dayTemp,$("tonight_qk").innerHTML=dayTypeTonight,$("tonight_temp").innerHTML=dayTempTonight;var f=n(l.yb.weatherinfo.weather2),b="",v="";switch(f){case"1":b="#64A1FE",v="sun";break;case"2":b="#6397E3",v="cloudy";break;case"3":b="#6E94D3",v="overcast";break;case"4":b="#84ADE5",v="rain";break;case"5":b="#7776BC",v="thunderstorm";break;case"6":b="#88DAF2",v="snow";break;case"7":b="#B1AAA0",v="haze"}$("container").style.backgroundImage="url(../img/new_popup_weather/weather_type_bg"+n(l.yb.weatherinfo.weather2)+".png)",$("today_tem_bg").className=v,$("tonight_weather").style.backgroundImage="url(../img/new_popup_weather/new_popup_type"+t(dayTypeTonight)+".png)"},sortTemp:function(e){return e=e.split("~").sort(function(e,t){return parseInt(e)-parseInt(t)}).join(" - "),e=e.split("℃ - ").sort(function(e,t){return parseInt(e)-parseInt(t)}).join(" / ")}};$("info_header").onclick=function(){try{var e=JSON.parse(localStorage.wData)}catch(t){var e={sk:{weatherinfo:{temp:""}}};throw t}send_report(137,102,"&value1=1&value2=1&value3="+localStorage.cityCode+"&value4="+e.sk.weatherinfo.temp),window.open(weatherURL+ws.cityCode),window.close()},$("weather_detail").onclick=function(){try{var e=JSON.parse(localStorage.wData)}catch(t){var e={sk:{weatherinfo:{temp:""}}};throw t}send_report(137,102,"&value1=1&value2=1&value3="+localStorage.cityCode+"&value2="+e.sk.weatherinfo.temp),window.open(weatherURL+ws.cityCode),window.close()},$("info_footer").onclick=function(e){var t=e.target||e.srcElement;"media_content"==t.id&&(window.open($("media_content").href),window.close()),send_report(137,102,"&value1=1&value2=3&value3="+localStorage.cityCode)},window.oncontextmenu=function(){return!1};